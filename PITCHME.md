### TDDがもたらした予想外の恩恵

---

### 自己紹介

![Image](assets/img/seachicken.jpg)

- TDD3年目

- TDD戦歴

  - iOS, Android, Node.js, .Net, Unity, Python

Note:
- 業務、個人開発で常に実践している

---

### まずTDDって何だっけ？

- テストを書いてから実コードを書く開発スタイル

- テストでも設計でもない

- 設計や品質等、考え方を鍛えるもの

![Image](assets/img/tdd_position.png)

Note:
- 1
  - テストとはテストコード、Excelじゃないよ
  - Test Driven Development、開発手法のこと
- 2
  - UTを書くことと混同？UTをやるのは現代では当たり前と言われている
  - TDDすると品質が上がる？品質はテストと設計が決める
- 3
  - （図のフローを説明）
  - 設計やテストをどう学ぶか？
  - TDDの価値に1人でも効率良く学べる点がある

---

### ふーん・・よく分からん

- 方法は公開されている

  - 書籍：[テスト駆動開発](https://www.amazon.co.jp/%E3%83%86%E3%82%B9%E3%83%88%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA-Kent-Beck/dp/4274217884)、[実践テスト駆動開発](https://www.amazon.co.jp/%E5%AE%9F%E8%B7%B5%E3%83%86%E3%82%B9%E3%83%88%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA-Object-Oriented-SELECTION-Freeman/dp/4798124583)
  - 動画：[@size[0.7em](de:code 2017 50分でわかるテスト駆動開発@t_wada)](https://channel9.msdn.com/Events/de-code/2017/DO03)

- しかし、重要性が分かるのはずっと先

効果には段階がある、順に見ていこう👉

Note:
- 0
  - 実体験がないと利点が非常にわかり難い
- 1
  - 方法はプロから学んだ方が良い
  - 方法を伝えても物好きしか始めない
  - どういった価値があったのか話して興味を持ってもらうのが目的
- 2
  - 数年掛かる
  - ある程度慣れると、大げさだなで終わってしまう

---

### TDD1年目
#### テストができないという気付き

- 🤯 シングルトンの影響でテストできない

- 😵 通信のテストが安定しない・・

- 🤔 void戻り値をどうやってテストするの？

- etc.

Note:
- 0
  - テスト駆動開発を読みながら始める
- 1
  - xxManagerとか、副作用を扱うクラスを参照するとアウト
- 2
  - ユニットテストでやるか区別できていない
- 3
  - テストが目的ではない、テストしなくていいやつ
  - テストしたければ、void戻り値の処理にロジックを書く設計が悪い

+++

@size[0.7em](*良い設計はテスト可能であり、テスト可能でない設計は悪い設計である、ということは常に真実です 〜マイケル・C・フェザーズ〜*)

![LegacyCode](assets/img/legacy_code.jpg)

💡10年以上前のこの言葉が今も有効に働く

Note:
- 重要な観点を紹介
- 設計とテストは密に関連
- テストは自動テスト、デグレ抑止に必要、テスト可能を意識した設計は多くある
- 設計の破綻があるとテストが動かなくなるのですぐに明るみに出る

+++

#### スキル不足を痛感する時期

- テストの書き方、粒度のバランス

- 設計を学ばないとテストも書けない

✅ 徐々にグリーンへ

Note:
- 1
  - assert、テストダブルへ慣れること
  - 粒度は特に難しい、多くても速度が落ちることも
  - 実践の数を増やして感覚を掴む
- 2
  - テストが書けなくて設計スキルを上げるのは難しい
  - テストを先に書くスタイルにより、必要にかられてデザインパターンを探すので価値が分かり易い
- x
  - テストを成功させた色
  - 最初はUtilとか部分的にやってみると良い
  - グリーンにする「快感」
  - 自分のタスクの完成を明確に知る
  - 中毒性がある、こうなれば上手くいく

---

### TDD2年目
#### 呼吸するようにテストを書く

- テスト可能な領域を広げる

- ドメインに集中する

Note:
- 0
  - 徐々に慣れてテストを書くのが当たり前になる
  - 息を吸ったらテスト、吐いたら実コードを書く
- 1
  - 最初は局所的なテストしかできない
  - もっと多くの場所をテストしたくなる
  - その時に避けられない知識がアーキテクチャ
- 2
  - ビジネスロジックとも言う
  - サービス特有の仕様
  - 独創的、ここを作るのがプログラマの腕の見せ所

+++

#### 設計の基盤をテストで評価する

- アーキテクチャを理解する必要あり

- MVW系、Clean Architecture等基礎は同じ

![TestPyramid](assets/img/testPyramid.png)

@size[0.5em](TestPyramid: )[@size[0.5em](https://martinfowler.com/articles/practical-test-pyramid.html)](https://martinfowler.com/articles/practical-test-pyramid.html)

Note:
- 1
  - MVC、MVVM・・長くなるので話さない
  - アーキテクチャを学ぶと多くの部分がテスト可能になる
- 2
  - 規模に応じて選択が変わる
- 3
  - 理解しないと選択もできない、TestPyramidという考え方が役に立つ
  - （軽く図の説明）
  - 上位は、このボタンを押すと結果がこう出るとかユーザに近い操作のテスト、e2eテスト、QAが担当することあり
  - 中央、下位がプログラマの設計やテストに影響する部分で、比重も大きい
  - 中央は、上位や下位の影響も受けるのでメンテコストが高いが、実際の動作に近くなるので結合漏れは減る、P、Use Cases
  - 下位は、疎結合にすることで安全且つ高速な開発が狙える、Model、Entities
  - 設計判断にはトレードオフがつきものなので、テストで評価する軸があると役に立つ

+++

#### 設計の詳細をテストで評価する

- ドメインに集中する

  - バグ**探し**で時間を浪費しない

  - 解決する対象をどうロジックに落とし込むか？

- セルフコードレビュー 

  - 可読性向上

  - 設計の単純化

Note:
- 1.1
  - たまにどこにバグの原因があるか分からないといったことがある
  - 探すという状況が異常、アーキで機械的な仕様から分離し、サービス固有のロジックに注力する
- 1.2
  - どうクラス設計、モデリングするか？
  - ここが本来エンジニアにとって重要で楽しむ部分
  - DDDが深掘りしている
- 2
  - テストとはAPI呼び出し、利用者視点で客観的な評価ができる

---

### TDD3年目
#### TDDって何だっけ？

- テストがなくてもTDDしている

- 考え方の変化（怠惰、短気、傲慢）

Note:
- 0
  - ここから先は私見がだいぶ入る
- 1
  - テストのお陰で身についたものが当たり前の知識となり、柔軟に選択できるように
- 2
  - まとめているとプログラマの三大美徳に当てはまる

+++

### 怠惰

- バグの頻度を実感し、怠惰を極める

- 面倒だからテストを書く

  - 休日前にバグ発覚なんて嫌

  - 単純なロジックではテストを書かない

メンテナンスコストを最小化する

Note:
- 1
  - 仕変で少し修正しただけで、想定外の箇所がレッドになる
  - どれだけ頻繁にデグレが起きているかを知る
- x
  - スケジュール、価値を加味した柔軟な開発
  - 新規メンバに口頭説明面倒だからドキュメント書こうとか発展する
  - 納品作業が面倒だからCDで自動化

+++

### 短気

- 実機で確認するのが億劫

  - ビルド＆実機動作までの数秒-数分のロス

  - 対応した画面までポチポチ遷移する？

- TDDはスポーツ

  - コンマ数秒の世界でコーディング

  - 集中が切れないようにクリーンに保つ

Note:
- 1.1
  - 毎回Twitter見る？
- 2.1
  - 副作用を分離することで初めて生まれる
  - フロー状態、気がつくと夕方
  - ずっとタイプし続ける、攻めの開発
- 2.2
  - 自分が楽しくなくなるモチベで設計を改善する
- x
  - ツールに頼りだす、Lint、CIで品質低下を早期発見

+++

### 傲慢

- コードへの愛

  - 何度も評価→改善→愛着が湧く

  - 単一のクラス／モジュールが製品でもある

- 自惚れ

  - ロジックを細分化し、全てを想定内にする

  - 迅速な仕変／バグ対応を何度も経験する

Note:
- 1
  - このクラスめっちゃカッコ良くね？見て欲しい
- 2.1
  - 上手く動くか不安だなーってのが減る
- 2.2
  - TDDを続けているとこの経験を何度もすることになるので仕方がない
  - 俺天才と自己肯定してあげたら人生が充実する

---

### まとめ

- TDDは方法以上に心の友

- 優れたプログラマのスタートラインまで導く思考術

Note:
- 1
  - 品質を上げるとか堅い話以上に、楽しくコードを書き続けるためのテクニック
- 2
  - 自分に足りないものが見えてきた
  - 下地ができたので安心して色々な技術を学べそうだなと感じてる
  - DDDでドメインモデルの探求
  - FP、RP、OSSに貢献したい
  - アジャイルの速度になった、高品質、素早く作る
  - バグとか汚いとか低レベルな話は止めて、サービスがどうやれば改善するか根本的な解決を考えていく

